{% extends 'reserva/base.html' %}
{% load static %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="{% static '/js/bootstrap-datepicker.min.js' %}"></script>
<script src="{% static '/locales/bootstrap-datepicker.pt-BR.min.js' %}"></script>
<div class="reservas__picker row justify-content-md">
    <h1>Reservas &rarr; {{carro}}</h1>
    <h3>Escolha uma data</h3>
    <input style="display:none" id="car" value="{{carro}}">
    <input style="display:none" id="resultados">
    <div class="col-6">
        <form>
        <select id="items">
            <option>Recursos: </option>
            <option value="FordKa">Ford Ka</option>
            <option value="Onix">Onix</option>
            <option value="HB20">HB20</option>
            <option value="Sala andar 1">Sala 1° andar</option>
            <option value="Sala Terreo">Sala Térreo</option>
            <option value="Sala Maior Conad">Sala Maior Conad</option>
            <option value="Sala Menor Conad">Sala Menor Conad</option>
            <option value="Auditorio">Auditório</option>
        </select>
        </form>
    </div>

    <div class="col-6">
        <form action="" method="post">
            {% csrf_token %}
        <div id="datepicker" class="datepicker">
            <input type="text" style="display:none" name="result" onchange="teste()" id="result">
        </div>
        <input type="submit" value="Enviar">
        </form>
    </div>
    <div id="sspan" style="display:none">
        <p id="spanP"></p>
    </div>
</div>
<script>
async function main(){
 const car = document.getElementById('car');
 const response = await axios.get(`http://127.0.0.1:8000/json/${car.value}`);
 const data = response.data;
 const items = Object.values(data);
 var date = new Date();
 date.setDate(date.getDate());
 const buttonCar = document.getElementById('btncar')
    $('#datepicker').datepicker({
        startDate: date,
        daysOfWeekDisabled: [0, 6],
        language: 'pt-BR',
        beforeShowDay: function(date) {
             for (var i = 0; i < items.length; i++){
                mes = items[i]["mes"];
                dias = items[i]["dia"];
                if (date.getMonth() == mes){
                    if (~dias.indexOf(date.getDate())) {
                        return {classes: 'highlighted', tooltip: 'Title'};
                    }
                }

            }
        }

    });
 }
main()

async function teste(){
    const car = document.getElementById('car');
    const response = await axios.get(`http://127.0.0.1:8000/json/${car.value}`);
    const data = response.data;
    const items = Object.values(data);
    const teste= document.getElementById('result').value
    const sspan = document.getElementById('sspan');
    for( i = 0;i<=items.length;i++){
        for(j=0;j<=items.length;j++){
            if(teste === items[i]["datas"][j]){
                sspan.style.display="inline"
                const varTexto = document.getElementById('spanP');
                varTexto.innerHTML =`<p>motivo ${items[i]['motivo'][j]} autor ${items[i]['autor'][j]}</p>`;
                break;
            }else{
                const sspan = document.getElementById('sspan').style.display="none";
            }
        }
        if (sspan.style.display === "inline"){
            break;
        }
    }
};
$(document).ready(function(){
    $('#items').on('change',function(){
        var itemsName = $(this).children("option:selected").val();
        window.location.href=`http://127.0.0.1:8000/reservas/${itemsName}`
    });
});
</script>
{% endblock %}