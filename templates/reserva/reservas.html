{% extends 'reserva/base.html' %}
{% load static %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="{% static '/js/bootstrap-datepicker.min.js' %}"></script>
<script src="{% static '/locales/bootstrap-datepicker.pt-BR.min.js' %}"></script>

{% if form %}
<form action="" method="post">
    {% csrf_token %}
    {% for item in form.visible_fields %}
    <label for="{{form.id_for_label}}">{{item.label}}</label>
    {{item}}
    {% endfor %}
    <input type="submit" value="Pesquisar" class="btn btn-success">
</form>
{% endif %}
<select name="selectCarro">
    <option value="Ford Ka">Ford Ka</option>
    <option value="Onix">Onix</option>
    <option value="HB20">HB20</option>
</select>
<input style="display:none" id="resultados">
<div >
    <form action="Sala" method="post">
        {% csrf_token %}
    <div id="datepicker" class="datepicker border-1">
        <input type="text" style="display:none" name="result" onchange="teste()" id="result">
    </div>
    <input type="submit" value="Enviar">
    </form>
</div>
<div id="sspan" style="display:none">
    <p id="spanP"></p>
</div>
<script>
async function main(){
 const response = await axios.get('http://127.0.0.1:8000/json');
 const data = response.data;
 const items = Object.values(data);
 var date = new Date();
 date.setDate(date.getDate());
    $('#datepicker').datepicker({
        startDate: date,
        daysOfWeekDisabled: [0, 6],
        language: 'pt-BR',
        beforeShowDay: function(date) {
             for (var i = 0; i < items.length; i++){
                mes = items[i]["mes"];
                dias = items[i]["dia"];
                if (date.getMonth() == mes){
                    if (~dias.indexOf(date.getDate())) {
                        return {classes: 'highlighted', tooltip: 'Title'};
                    }
                }

            }
        }

    });
 }
main()

async function teste(){
    const response = await axios.get('http://127.0.0.1:8000/json');
    const data = response.data;
    const items = Object.values(data);
    const teste= document.getElementById('result').value
    const sspan = document.getElementById('sspan');
    for( i = 0;i<=items.length;i++){
        for(j=0;j<=items.length;j++){
            if(teste === items[i]["datas"][j]){
                sspan.style.display="inline"
                const varTexto = document.getElementById('spanP');
                varTexto.innerHTML =`<p>motivo ${items[i]['motivo'][j]} autor ${items[i]['autor'][j]}</p>`;
                break;
            }else{
                const sspan = document.getElementById('sspan').style.display="none";
            }
        }
        if (sspan.style.display === "inline"){
            break;
        }
    }
};

</script>
{% endblock %}